---
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, thumbnail, tags = [] } = Astro.props;

// 現在のページのURL
const currentUrl = new URL(Astro.url.pathname, Astro.site).toString();

// X共有用のテキストとURL
const shareText = `${title} | Daily Scraps`;
const xShareUrl = `https://x.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(currentUrl)}`;

function formatDate(date: Date | string) {
 const d = new Date(date);
 return d.toLocaleDateString('ja-JP', {
   year: 'numeric',
   month: 'long',
   day: 'numeric'
 });
}
---

<html lang="ja">
 <head>
   <BaseHead title={title} description={description} />
   <style>
     main {
       max-width: 900px;
       margin: 0 auto;
       padding: 2rem;
     }
     .hero-image {
       width: 100%;
       height: 360px;
       object-fit: cover;
       border-radius: 12px;
       margin-bottom: 2rem;
     }
     .title {
       font-size: 2.5rem;
       margin: 1rem 0;
     }
     .date {
       color: #666;
       margin-bottom: 1rem;
     }
     .tags {
       display: flex;
       gap: 0.5rem;
       margin-bottom: 2rem;
     }
     .tag {
       padding: 0.25rem 0.75rem;
       background: #f0f0f0;
       border-radius: 1rem;
       text-decoration: none;
       color: #666;
       font-size: 0.875rem;
       transition: all 0.2s;
     }
     .tag:hover {
       background: var(--accent);
       color: white;
     }
     .prose {
       line-height: 1.8;
       color: #333;
     }
     .prose h2 {
       margin-top: 2rem;
       margin-bottom: 1rem;
     }
     
     /* X共有ボタンのスタイル */
     .share-section {
       margin: 3rem 0;
       padding: 2rem 0;
       border-top: 1px solid #e5e5e5;
     }
     
     .share-button {
       display: inline-flex;
       align-items: center;
       gap: 0.5rem;
       padding: 0.75rem 1.5rem;
       background-color: #000000;
       color: white;
       border-radius: 8px;
       text-decoration: none;
       font-weight: 500;
       transition: transform 0.2s, opacity 0.2s;
     }
     
     .share-button:hover {
       transform: translateY(-2px);
       opacity: 0.9;
     }

     /* レスポンシブ対応 */
     @media (max-width: 768px) {
       main {
         padding: 1rem;
       }

       .hero-image {
         height: 240px;
         border-radius: 8px;
         margin-bottom: 1.5rem;
       }

       .title {
         font-size: 1.8rem;
       }

       .tags {
         gap: 0.375rem;
         margin-bottom: 1.5rem;
       }

       .tag {
         font-size: 0.8rem;
       }

       .prose {
         font-size: 0.95rem;
       }

       .share-section {
         margin: 2rem 0;
         padding: 1.5rem 0;
       }
     }

     @media (max-width: 480px) {
       main {
         padding: 0.75rem;
       }

       .hero-image {
         height: 200px;
         border-radius: 6px;
         margin-bottom: 1rem;
       }

       .title {
         font-size: 1.5rem;
         margin: 0.75rem 0;
       }

       .date {
         font-size: 0.9rem;
         margin-bottom: 0.75rem;
       }

       .tags {
         flex-wrap: wrap;
         gap: 0.25rem;
         margin-bottom: 1rem;
       }

       .tag {
         padding: 0.2rem 0.5rem;
         font-size: 0.75rem;
       }

       .prose {
         font-size: 0.9rem;
         line-height: 1.7;
       }

       .prose h2 {
         font-size: 1.3rem;
         margin-top: 1.5rem;
         margin-bottom: 0.75rem;
       }

       .prose h3 {
         font-size: 1.1rem;
       }

       .share-section {
         margin: 1.5rem 0;
         padding: 1rem 0;
       }

       .share-button {
         width: 100%;
         justify-content: center;
         padding: 0.625rem 1rem;
         font-size: 0.9rem;
       }
     }
   </style>
 </head>

 <body>
   <Header />
   <main>
     <article data-pagefind-body>
       {thumbnail && (
         <img
           class="hero-image"
           width={1020}
           height={360}
           src={thumbnail}
           alt={title}
         />
       )}
       <h1 class="title" data-pagefind-meta="title">{title}</h1>
       {pubDate && (
         <div class="date">{formatDate(pubDate)}</div>
       )}
       {tags && tags.length > 0 && (
         <div class="tags">
           {tags.map((tag: string) => (
             <a href={`/daily-scraps/tags/${tag}/`} class="tag">
               #{tag}
             </a>
           ))}
         </div>
       )}
       
       <div class="prose">
         <slot />
       </div>
       
       <!-- X共有ボタン -->
       <div class="share-section">
         <a 
           href={xShareUrl}
           target="_blank"
           rel="noopener noreferrer"
           class="share-button"
         >
           <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
             <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
           </svg>
           Xで共有
         </a>
       </div>
     </article>
   </main>
   <Footer />
 </body>
</html>